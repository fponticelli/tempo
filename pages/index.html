<p><a href="https://github.com/fponticelli/tempo/actions?query=workflow%3A" title="Build+and+Test"><img src="https://github.com/fponticelli/tempo/workflows/Build%20and%20Test/badge.svg" alt="Actions Status"></a>
<a href="https://github.com/fponticelli/tempo"><img src="https://img.shields.io/github/stars/fponticelli/tempo?label=Star%20me%20on%20Github&amp;style=social" alt="GitHub stars"></a></p>
<p style="text-align: center">
  <img src="./assets/icon-512x512.png" style="width: 128px" alt="Tempo logo">
</p>
<p><a href="https://github.com/fponticelli/tempo">Github Repository</a></p>
<p>Tempo is a framework to build dynamic front-end applications.</p>
<p>This is not an officially supported Google product.</p>
<h1 id="sampleapplication">Sample Application</h1>
<p>A Tempo application operates on two main instances:</p>
<ul>
<li><strong>Store</strong> as in data-store, or state holder</li>
<li><strong>Template</strong>: an instance with a function <code>render(state: State, context: Context): View&lt;State&gt;</code></li>
</ul>
<p><code>Tempo.render</code> uses these two instances to create and manage your application.</p>
<p>Here is a full example of a little widget that increments and decrements a counter, updating as the value changes.</p>
<p>You can try out the <a href="demo/readme/">demo running here</a>.</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> Tempo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'tempo-dom/lib/tempo'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> div<span class="token punctuation">,</span> button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'tempo-dom/lib/html'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Store <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'tempo-store/lib/store'</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">type</span> Action <span class="token operator">=</span> <span class="token string">'increment'</span> <span class="token operator">|</span> <span class="token string">'decrement'</span>

<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> action<span class="token operator">:</span> Action<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span> <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span> <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">this should never happen</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> Store<span class="token punctuation">.</span><span class="token function">ofState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state<span class="token punctuation">,</span> reducer <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> template <span class="token operator">=</span> div<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span> Action<span class="token operator">&gt;</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> attrs<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'app'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">div</span><span class="token punctuation">(</span><span class="token punctuation">{</span> attrs<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'count count-small'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">div</span><span class="token punctuation">(</span><span class="token punctuation">{</span> attrs<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'count'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">div</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> attrs<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'buttons'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">button</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span>
        events<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'decrement'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        attrs<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function-variable function">disabled</span><span class="token operator">:</span> <span class="token parameter">count</span> <span class="token operator">=&gt;</span> count <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">'-'</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">{</span> events<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'increment'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span>

Tempo<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span> store<span class="token punctuation">,</span> template <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>In this simple example <code>State</code> is just a plain <code>number</code>. In a more sophisticated examples it usually a data object.</p>
<p>The UI rendering will only depend on the <code>State</code> and nothing else. This is one of the major advantages of Tempo; the way a UI renders is entirely contained within its State. Testing the UI is greatly simplified using this principle as it will consistently render the same result for any given state.</p>
<p>We declare an initial <code>State</code> that is the default for our application.</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token number">0</span>
</code></pre>
<p>Each interaction with the application is performed using Actions. Actions, like State, are defined per-application. Since actions are usually alternatives, they are well represented by union types (tagged union types are ideal to pair an alternative with additional data). Actions can contain more data than just their kind, but this simple example's Actions don't require any additional information.</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token keyword">type</span> Action <span class="token operator">=</span> <span class="token string">'increment'</span> <span class="token operator">|</span> <span class="token string">'decrement'</span>
</code></pre>
<p>In a traditional JavaScript application, an event can be mapped to an event handler with the following signature.</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token keyword">type</span> <span class="token function-variable function">EventHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token operator">:</span> Event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</code></pre>
<p>In Tempo, the event handler has a more advanced signature:</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token keyword">type</span> EventHandler <span class="token operator">=</span> <span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token punctuation">,</span> Ev <span class="token keyword">extends</span> <span class="token class-name">Event</span> <span class="token operator">=</span> Event<span class="token punctuation">,</span> El <span class="token keyword">extends</span> <span class="token class-name">Element</span> <span class="token operator">=</span> Element<span class="token operator">&gt;</span> <span class="token operator">=</span>
  <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">:</span> State<span class="token punctuation">,</span> event<span class="token operator">:</span> Ev<span class="token punctuation">,</span> element<span class="token operator">:</span> El</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Action <span class="token operator">|</span> <span class="token keyword">undefined</span>
</code></pre>
<p>The function takes the current state, the DOM event, and the element associated with the event. If it returns an Action, the reducer function that updates the state will be invoked with the returned Action. If it returns <code>undefined</code>, the reducer function will not be invoked at all.</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">{</span> events<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'increment'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span>
</code></pre>
<p>Events are declared in the <code>events</code> property of an element options.</p>
<p>All attributes and text nodes in Tempo can be either Derived or Literal values. If they are derived, the content generated in the web-page will depend on the current state. If they are literals, they are assigned on the first render and never altered again for the life-cycle of the wrapping elements. Attributes are assigned in the <code>attrs</code> property of the options.</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> action<span class="token operator">:</span> Action<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter"><span class="token builtin">number</span></span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span> <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span> <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">this should never happen</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> Store<span class="token punctuation">.</span><span class="token function">ofState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state<span class="token punctuation">,</span> reducer <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>In the code above we create an instance of <code>Store</code>. A Store wraps a <code>Property</code>. A Property is an observable instance that triggers its own listeners whenever the value that it holds is changed.</p>
<p>A Store adds to the application its ability to change state in reaction to Actions. This State update is defined by the <code>reducer</code> function above. A reducer as the simple signature of:</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token keyword">type</span> <span class="token function-variable function">Reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">:</span> State<span class="token punctuation">,</span> action<span class="token operator">:</span> Action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> State
</code></pre>
<p>The reducer takes the current State and an Action that just occurred (usually from some user interaction) and returns a new State to replace the original. A reducer function should not introduce side-effects, like server calls, or perform heavy computations.</p>
<p>If you want to perform async operations, you can do that by observing <code>store.observable</code>. The listeners for this object take four arguments: <code>(state: State, action: Action, previousState: State, changed: boolean)</code>. In a listener you can, for example, call a remote service. Once you have an async response, you can invoke <code>store.process(action)</code> with a new Action that will be applied to the store.</p>
<p>In our example, <code>reducer</code> is simply creating a new state where <code>count</code> is either incremented or decremented.</p>
<p><strong>Note</strong>: <code>Property</code> doesn't trigger its listeners unless the value is actually changed. Setting the same value twice will not trigger a second change. This behavior can be controlled by passing an optional equivalence <code>equal: (a: State, b: State) =&gt; boolean</code> function. By default, the implementation provided will perform a strict comparison.</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token keyword">const</span> template <span class="token operator">=</span> div<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span> Action<span class="token operator">&gt;</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> attrs<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'app'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">div</span><span class="token punctuation">(</span><span class="token punctuation">{</span> attrs<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'count count-small'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">div</span><span class="token punctuation">(</span><span class="token punctuation">{</span> attrs<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'count'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">div</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> attrs<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'buttons'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">button</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span>
        events<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'decrement'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        attrs<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function-variable function">disabled</span><span class="token operator">:</span> <span class="token parameter">count</span> <span class="token operator">=&gt;</span> count <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">'-'</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">{</span> events<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token function-variable function">click</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'increment'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span>

Tempo<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span> store<span class="token punctuation">,</span> template <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Finally the UI! Each element, like <code>div</code> above, takes one or more arguments.</p>
<p>The first argument is for the element's options. In <code>attrs</code> if a literal value is plassed, like the attribute <code>class: 'app'</code> above, it will be rendered once and cannot be updated dynamically. For dynamic values a function from <code>State</code> to the attribute type is required.</p>
<p>The rest of the arguments are optional children of the element. The simplest child node is a plain <code>string</code> that is mapped to a DOM text node. A text node can also be dynamic when represented by a function <code>State =&gt; string</code>. The text will then change when the state is changed. In our example, the <code>String</code> function is used in the template to render the <code>count</code> as a text node and will update when the state changes.</p>
<p>Just for fun we added <code>disabled</code> and made it dependent on <code>count</code>. When <code>count</code> is zero or less we will not be able to click it.</p>
<p>When the template is defined, nothing happens except that we have an instance of <code>DOMElement&lt;State, Action, HTMLDivElement&gt;</code>. This instance implements <code>DOMTemplate&lt;State, Action&gt;</code> which exposes the method <code>render: (ctx: DOMContext, state: State) =&gt; View&lt;State&gt;</code>. When that method is invoked, it will perform the actual creation and modification of the browser's DOM elements. The <code>View</code> returned by the <code>render</code> method has a method <code>destroy()</code> to remove what has been generated and <code>change(state: State)</code> to update its content.</p>
<p>These methods are managed and wired automatically when <code>store</code> and <code>template</code> are passed to <code>Tempo.render()</code>.</p>
<p>The entire app fits 6.3kb when gzipped!</p>
<p>This <a href="demo/benchmark/">simple app tracks performance</a> improvements/regressions with new versions of the library.</p>