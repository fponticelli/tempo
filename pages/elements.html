<h1 id="elements">Elements</h1>
<p>A template is built by assembling elements together. <code>@tempo/dom/lib/html</code> contains all the definitions for all HTML SVG elements (<code>@tempo/dom/lib/svg</code> for SVG elements).</p>
<h2 id="htmldsl">HTML DSL</h2>
<p>The best way to describe a Tempo template is to use the provided HTML builders. Each element and transform operation is described both as a function or as a method of the builder to allow chaining and nesting.</p>
<p>For example to create a <code>&lt;div&gt;</code> element there is an equivalent <code>DIV()</code> function. If you want to have two sibbling <code>&lt;div&gt;</code> elements you can chain them using <code>DIV().DIV()</code>. To nest elements and attributes you can use an <code>init</code> function:</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token constant">DIV</span><span class="token punctuation">(</span>
  <span class="token parameter">$</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">(</span><span class="token string">'header'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">H1</span><span class="token punctuation">(</span><span class="token parameter">$</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'Title'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token constant">DIV</span><span class="token punctuation">(</span><span class="token parameter">$</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">(</span>'body<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>This generates the following HTML:</p>
<pre><code class="html language-html">&lt;div class="header"&gt;
  &lt;h1&gt;Title&lt;/h1&gt;
&lt;/div&gt;
&lt;div class="body"&gt;&lt;/div&gt;
</code></pre>
<p>The Tempo DSL uses a few name conventions to make it simpler to distinguish between the composing members and to avoid name conflicts between attribute, elements and transform methods.</p>
<p>The DSL uses</p>
<ul>
<li>all capital-case names for native HTML (and SVG) elements.</li>
<li>all lower-case names for element attributes and for the special <code>text</code> attribute.</li>
<li>capitalized names prefixed with <code>on</code> for event handling.</li>
<li>capitalized names for lifecycle and transform functions/methods.</li>
</ul>
<p>Almost all values in the DSL can be either literal values or functions from State to a literal value.</p>
<h2 id="tempolifecycle">Tempo Lifecycle</h2>
<p>Each DOM element has four additional special attributes:</p>
<p>TODO</p>
<h2 id="transformelements">Transform Elements</h2>
<p>TODO</p>
<h2 id="mapstateandaction">Map state and action</h2>
<p>TODO</p>
<h2 id="iterate">Iterate</h2>
<p>TODO</p>
<p>Adapter
LocalAdapter
Component
CaptureState
ReleaseState
Iterate
MapState
MapStateAndKeep
MapAction
MapQuery
Match
MatchKind
MatchBool
MatchValue
MatchOption
MatchResult
MatchAsync
MatchAsyncResult
Lazy
Fragment
ForEach
Portal
PortalWithSelector
HeadPortal
BodyPortal
SimpleComponent
Unless
Until
When</p>
<h2 id="foreach">ForEach</h2>
<p>The <code>ForEach</code> element takes a state whose shape is an array (<code>State extends any[]</code>) and applies individually each element in the array to the children nodes. This is useful for lists or tables.</p>
<h2 id="portal">Portal</h2>
<p>A <code>portal</code> allows to mount a node outside of the natural nesting. The portal module provides the following nodes:</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token keyword">const</span> portal <span class="token operator">=</span> <span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token operator">&gt;</span><span class="token punctuation">(</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getParent</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">doc<span class="token operator">:</span> Document</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Element
    <span class="token function-variable function">append</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">doc<span class="token operator">:</span> Document<span class="token punctuation">,</span> node<span class="token operator">:</span> Node</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>children<span class="token operator">:</span> DOMChild<span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> DOMTemplate<span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token operator">&gt;</span>

<span class="token keyword">const</span> portalWithSelector <span class="token operator">=</span> <span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token operator">&gt;</span><span class="token punctuation">(</span>
    <span class="token parameter">options<span class="token operator">:</span> <span class="token punctuation">{</span> selector<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>children<span class="token operator">:</span> DOMChild<span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span>
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> DOMTemplate<span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token operator">&gt;</span>

<span class="token keyword">const</span> headPortal <span class="token operator">=</span> <span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>children<span class="token operator">:</span> DOMChild<span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> DOMTemplate<span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token operator">&gt;</span>

<span class="token keyword">const</span> bodyPortal <span class="token operator">=</span> <span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>children<span class="token operator">:</span> DOMChild<span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> DOMTemplate<span class="token operator">&lt;</span>State<span class="token punctuation">,</span> Action<span class="token operator">&gt;</span>
</code></pre>
<h2 id="until">until</h2>
<p>The <code>until</code> node, much like the <code>forEach</code> is for state that represent collections or repeatable elements. Its implementation requires that a function <code>repeatUntil</code> is provided with the following signature:</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token function-variable function">repeatUntil</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">:</span> OuterState<span class="token punctuation">,</span> index<span class="token operator">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> InnerState <span class="token operator">|</span> <span class="token keyword">undefined</span>
</code></pre>
<p>The function is invoked <code>n</code> times until a result of <code>undefined</code> is returned. For each successful invocation, the children nodes will be rendered with the returned result.</p>
<h2 id="when">when</h2>
<p><code>when</code> and <code>unless</code> nodes are for containers that will display their contents conditionally. A <code>condition</code> function needs to be provided:</p>
<pre class="language-ts"><code class="ts language-ts"><span class="token function-variable function">condition</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">:</span> State</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span>
</code></pre>
<h1 id="component">Component</h1>
<p>A <code>component</code> is a special kind of node that manages its own state. When embedded in other nodes it does not automatically propagate actions up the hierarchy, nor changes its own contents when the outer state is updated.</p>
<p>A component takes an instance of <code>Store</code> to manage its state, it is in fact what <code>Tempo.render</code> wraps the passed template around.</p>
<h2 id="adapter">Adapter</h2>
<p>An adapter is needed if you need for a component to be able to communicate with its container. An adapter takes an optional <code>mergeStates</code> attribute:</p>
<pre class="language-ts"><code class="ts language-ts">mergeStates<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">outerState<span class="token operator">:</span> OuterState<span class="token punctuation">,</span> innerState<span class="token operator">:</span> InnerState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> InnerState <span class="token operator">|</span> <span class="token keyword">undefined</span>
</code></pre>
<p>This function allows for the <code>OuterState</code> to be merged into the <code>InnerState</code> and trigger a template change. If the function returns <code>undefined</code> then the inner state will not be updated.</p>
<p>It can also take a <code>propagate</code> function:</p>
<pre class="language-ts"><code class="ts language-ts">propagate<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">args<span class="token operator">:</span> PropagateArg<span class="token operator">&lt;</span>OuterState<span class="token punctuation">,</span> InnerState<span class="token punctuation">,</span> OuterAction<span class="token punctuation">,</span> InnerAction<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>

<span class="token comment">// where PropagateArg is</span>

<span class="token keyword">interface</span> <span class="token class-name">PropagateArg</span><span class="token operator">&lt;</span>OuterState<span class="token punctuation">,</span> InnerState<span class="token punctuation">,</span> OuterAction<span class="token punctuation">,</span> InnerAction<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  action<span class="token operator">:</span> InnerAction
  innerState<span class="token operator">:</span> InnerState
  outerState<span class="token operator">:</span> OuterState
  <span class="token function-variable function">dispatchInner</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">action<span class="token operator">:</span> InnerAction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
  <span class="token function-variable function">dispatchOuter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">action<span class="token operator">:</span> OuterAction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This function allows to react to inner actions. When the <code>propagate</code> function is invoked, the implementor can decide to trigger new inner actions <code>dispatchInner</code> or outer actions <code>dispatchOuter</code>.</p>